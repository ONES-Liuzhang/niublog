# hash & history

### åŸºç¡€çŸ¥è¯†

#### hash å’Œ history

hash å’Œ history æ˜¯æµè§ˆå™¨çš„ä¸¤ç§æ¨¡å¼

ä¸¾ä¸ªä¾‹å­ `https://myblog.com/vue-router/#title` 

å…¶ä¸­ hash å€¼å°±ä¸º `#title`ï¼Œhistory å€¼ä¸º `/myblog.com/vue-router/`

##### æ ¹æœ¬åŒºåˆ« 

1. history æ”¹å˜æ—¶ä¼šå‘æœåŠ¡å™¨è¯·æ±‚æ–°é¡µé¢
2. hash æ”¹å˜æ—¶ä¸ä¼šå‘æœåŠ¡å™¨å‘æ–°è¯·æ±‚ï¼Œä¼ ç»Ÿé¡µé¢ä¸­ç»å¸¸ä½¿ç”¨hashè¿›è¡Œå½“å‰é¡µé¢å„ä¸ªä½ç½®çš„æ»šåŠ¨è·³è½¬

##### èŽ·å–

```js
// èŽ·å–hash https://myblog.com/vue-router/#title
location.hash // #title
location.pathname // /myblog.com/vue-router/
```



#### è·¯ç”±çš„è·³è½¬

è¿™äº›éƒ½æ˜¯æµè§ˆå™¨æä¾›ç»™å¼€å‘è€…çš„API

1. `location.href = "xxx"`
2. `history.pushState(state, title, url)`
3. `history.go(number)`



#### æµè§ˆå™¨è·¯ç”±äº‹ä»¶

##### popstate å’Œ hashchange ðŸ”¥

çŽ°ä»£æµè¡Œçš„SPAæ¡†æž¶çš„è·¯ç”±åŸºæœ¬éƒ½æ˜¯ä¾èµ–è¿™ä¸¤ä¸ªAPIï¼Œæ‰€ä»¥å¾ˆé‡è¦ï¼Œä¸€å®šè¦æžæ¸…æ¥šå®ƒä»¬çš„è§¦å‘æ—¶æœº

**1. å¦‚ä½•ç›‘å¬**

```js
window.addEventListener("popstate", function() {
  // ç›‘å¬åˆ°popstateè§¦å‘é€»è¾‘
})

window.addEventListener("hashchange", function() {
  // ç›‘å¬åˆ°hashchangeè§¦å‘é€»è¾‘
})
```

**2. è§¦å‘æ—¶æœº**

- 1. åˆ·æ–°é¡µé¢æ—¶ï¼Œä¸ä¼šè§¦å‘ `popstate` å’Œ `hashchange`

  - 1-1. åˆ·æ–°é¡µé¢æ—¶ï¼Œurlè§£æžåœ¨å‰ï¼ŒjsåŠ è½½åœ¨åŽï¼Œæ ¹æœ¬å°±æ²¡æœ‰æŒ‚è½½ç”¨æˆ·è‡ªå®šçš„ç›‘å¬äº‹ä»¶ï¼Œæ‰€ä»¥è‚¯å®šä¸ä¼šè§¦å‘

- 2. è°ƒç”¨`history.go(num)`

  - 2-1. `popstate` å’Œ `hashchange` éƒ½è§¦å‘ ðŸŒŸ

- 3. è°ƒç”¨`location.href="xxx"`

  - 3-1. `location.href="#/xxx"` ï¼š `popstate` å’Œ `hashchange` éƒ½è§¦å‘ ðŸŒŸ
  - 3-2. `location.href="/xxx/mmm"` ï¼š å‚è€ƒ 1-1 ä¼šåˆ·æ–°é¡µé¢ï¼Œä¸ä¼šè§¦å‘äº‹ä»¶

> æ€»ç»“ï¼š
>
> ä¼šè§¦å‘æµè§ˆå™¨çš„è·¯ç”±äº‹ä»¶çš„æ€»å…±æœ‰ä¸¤ç§æƒ…å†µ
>
> 1. history.go()  æˆ–è€…ç‚¹å‡»æµè§ˆå™¨çš„å‰è¿›ã€åŽé€€æŒ‰é’®
> 2. location.href="#/xxx"  åªæ”¹å˜urlä¸­çš„hashå€¼ï¼Œæ‰‹åŠ¨åœ¨åœ°å€æ ä¿®æ”¹ä¹Ÿä¼šè§¦å‘



#### è‡ªå®šä¹‰äº‹ä»¶

é™¤äº†ä¸Šé¢è¯´çš„æµè§ˆå™¨åŽŸç”Ÿäº‹ä»¶æ¥è§¦å‘`popstate` å’Œ `hashchange`ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰äº‹ä»¶æ¥æ‰‹åŠ¨è§¦å‘

Event ä¸‹æœ‰å¾ˆå¤š å­ç±»ï¼Œæ¯”å¦‚ `PopStateEvent` `ProgressEvent` `StorageEvent` ç­‰ç­‰



##### PopStateEvent

```js
// åˆ›å»ºä¸€ä¸ªäº‹ä»¶
function createPopstateEvent(state) {
  let evt
  try {
  	evt = new PopStateEvent("popstate", { state })
  } catch(e) {
    // å…¼å®¹ IE11
    evt = window.document.createEvent("PopStateEvent")
    evt.initEvent("popstate", false, false, state)
  }
  
  return evt
}
```

##### dispatchEvent

æ‰‹åŠ¨è§¦å‘ä¸€ä¸ªäº‹ä»¶

```js
window.addEventListener('popstate', (ev) => {
    console.log("popstate trigger ", ev)
})
const evt = createPopstateEvent()
window.dispatchEvent(evt)
```

